---
/**
 * Blog Index Page
 *
 * Main blog landing page that displays all blog posts
 * with proper layout, filtering, and pagination.
 */

// Using inline SVG icons for better performance and compatibility
import BaseLayout from '../../layouts/base-layout.astro';
import { generateCanonicalUrl } from '../../utils/path-resolvers';
import Button from '../../components/ui/Button.astro';
import AstroIcon from '../../components/ui/AstroIcon.astro';
// Using inline SVG icons instead of React components

const canonicalUrl = generateCanonicalUrl('/blog');

// Mock blog posts data - replace with actual CMS or markdown collection
const blogPosts = [
  {
    id: 1,
    title: 'The Future of AI in Web Development',
    excerpt:
      'Exploring how artificial intelligence is revolutionizing the way we build and interact with websites.',
    author: 'NosytLabs Team',
    date: '2024-01-15',
    category: 'AI & Technology',
    readTime: '5 min read',
    image:
'/images/blog/modern-web-development.webp',
    href: '/blog/future-of-ai-web-development',
  },
  {
    id: 2,
    title: 'Building High-Performance React Applications',
    excerpt:
      'Best practices and optimization techniques for creating lightning-fast React applications.',
    author: 'NosytLabs Team',
    date: '2024-01-10',
    category: 'Web Development',
    readTime: '8 min read',
    image:
'/images/blog/web-performance-optimization.webp',
    href: '/blog/high-performance-react-applications',
  },
  {
    id: 3,
    title: 'TypeScript Best Practices for 2024',
    excerpt:
      'Essential TypeScript patterns and practices every developer should know for modern web development.',
    author: 'NosytLabs Team',
    date: '2024-01-05',
    category: 'Programming',
    readTime: '6 min read',
    image:
'/images/blog/ai-integration-guide.webp',
    href: '/blog/typescript-best-practices-2024',
  },
];

const categories = ['All', 'AI & Technology', 'Web Development', 'Programming'];

// SEO configuration
const seoConfig = {
  title: 'Blog | Latest Insights on Web Development & AI | NosytLabs',
  description:
    'Stay updated with the latest trends in web development, AI integration, and technology insights. Expert articles, tutorials, and industry analysis.',
  keywords: [
    'web development blog',
    'AI insights',
    'technology articles',
    'programming tutorials',
    'industry trends',
  ],
};

// Get the featured post safely
const featuredPost = blogPosts.length > 0 ? blogPosts[0] : null;
---

<BaseLayout
  title={seoConfig.title}
  description={seoConfig.description}
  keywords={seoConfig.keywords}
  {canonicalUrl}
  type="website"
  preloadImages={featuredPost ? [featuredPost.image] : []}
>
  <!-- Hero Section -->
  <section class="section-xl text-center">
    <div class="container relative section-xl">
      <div class="text-center">
        <h1 class="text-4xl lg:text-6xl font-bold text-text mb-6">
          Latest <span class="text-primary">Insights</span>
        </h1>
        <p class="text-xl text-text-muted mb-8 max-w-3xl mx-auto">
          Stay ahead with expert insights on web development, AI integration, and emerging
          technologies. Practical guides, industry trends, and technical deep-dives.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button variant="primary" href="#posts" class="btn-lg flex items-center justify-center gap-2">
            <AstroIcon name="tabler:book" class="w-5 h-5" />
            Browse Articles
          </Button>
          <Button variant="secondary" href="/contact" class="btn-lg"> Subscribe to Updates </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Blog Posts Section -->
  <section id="posts" class="section-xl">
    <div class="container">
      <!-- Category Filter -->
      <div class="flex flex-wrap justify-center gap-4 mb-12">
        {
          categories.map(category => (
            <Button variant="outline" class="px-6 py-2 rounded-full">
              {category}
            </Button>
          ))
        }
      </div>

      <!-- Featured Post -->
      {
        featuredPost && (
          <div class="mb-16">
            <div class="section-header">
              <h2 class="section-title">Featured Article</h2>
            </div>
            <div class="bg-background rounded-2xl shadow-xl overflow-hidden group hover:shadow-2xl transition-all duration-300">
              <div class="md:flex">
                <div class="md:w-1/2">
                  <img
                    src={featuredPost.image}
                    alt={featuredPost.title}
                    decoding="async"
                    fetchpriority="high"
                    width="1200"
                    height="675"
                    sizes="(min-width: 768px) 50vw, 100vw"
                    class="w-full h-64 md:h-full object-cover group-hover:scale-105 transition-transform duration-300"
                  />
                </div>
                <div class="md:w-1/2 p-8">
                  <div class="flex items-center gap-4 mb-4">
                    <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium">
                      {featuredPost.category}
                    </span>
                    <span class="text-text-muted text-sm">
                      {featuredPost.readTime}
                    </span>
                  </div>
                  <h3 class="text-2xl font-bold text-text mb-4 group-hover:text-primary transition-colors">
                    {featuredPost.title}
                  </h3>
                  <p class="text-text-muted mb-6 leading-relaxed">
                    {featuredPost.excerpt}
                  </p>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center">
                        <AstroIcon name="tabler:user-circle" class="w-5 h-5 text-on-primary" />
                      </div>
                      <div>
                        <p class="font-medium text-text">
                          {featuredPost.author}
                        </p>
                        <p class="text-sm text-text-muted">{featuredPost.date}</p>
                      </div>
                    </div>
                    <Button href={featuredPost.href} variant="primary">
                      Read More
                    </Button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )
      }

      <!-- Blog Posts Grid -->
      <div class="grid-layout grid-3">
        {
          blogPosts.slice(1).map(post => (
            <article class="bg-background rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden group hover:scale-105">
              <div class="relative">
                <img
                  src={post.image}
                  alt={post.title}
                  loading="lazy"
                  decoding="async"
                  fetchpriority="low"
                  width="640"
                  height="360"
                  sizes="(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"
                  class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <div class="absolute top-4 right-4">
                  <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-medium">
                    {post.category}
                  </span>
                </div>
              </div>
              <div class="p-6">
                <div class="flex items-center justify-between mb-3">
                  <p class="text-sm text-text-muted">{post.date}</p>
                  <p class="text-sm text-text-muted">{post.readTime}</p>
                </div>
                <h3 class="text-xl font-bold text-text mb-3 group-hover:text-primary transition-colors">
                  {post.title}
                </h3>
                <p class="text-text-muted mb-4 leading-relaxed line-clamp-3">
                  {post.excerpt}
                </p>
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center">
                    <AstroIcon name="tabler:user-circle" class="w-4 h-4 text-on-primary" />
                  </div>
                  <p class="text-sm font-medium text-text">{post.author}</p>
                </div>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Blog newsletter form submission
  document.addEventListener('DOMContentLoaded', function() {
    const blogNewsletterForm = document.getElementById('blog-newsletter-form');
    if (blogNewsletterForm) {
      blogNewsletterForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitButton = this.querySelector('button[type="submit"]');
        const originalHTML = submitButton.innerHTML;
        
        // Disable submit button and show loading state
        submitButton.disabled = true;
        submitButton.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Subscribing...';
        
        try {
          const formData = new FormData(this);
          const data = Object.fromEntries(formData.entries());
          
          const response = await fetch('/api/contact/newsletter', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email }),
          });
          
          const result = await response.json();
          
          if (response.ok) {
            // Success feedback
            submitButton.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Subscribed!';
            submitButton.classList.add('bg-green-500', 'hover:bg-green-600');
            
            // Reset form
            this.reset();
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.className = 'text-green-600 dark:text-green-400 text-center mt-4 p-3 bg-green-100 dark:bg-green-900/20 rounded-lg';
            successMessage.textContent = 'Thank you for subscribing! You\'ll receive our latest blog updates.';
            this.appendChild(successMessage);
            
            // Remove success message after 5 seconds
            setTimeout(() => {
              if (successMessage.parentNode) {
                successMessage.parentNode.removeChild(successMessage);
              }
            }, 5000);
            
          } else {
            throw new Error(result.error || 'Subscription failed');
          }
        } catch (error) {
          console.error('Blog newsletter subscription error:', error);
          
          // Show error message
          const errorMessage = document.createElement('div');
          errorMessage.className = 'text-red-600 dark:text-red-400 text-center mt-4 p-3 bg-red-100 dark:bg-red-900/20 rounded-lg';
          errorMessage.textContent = 'Sorry, there was an error. Please try again later.';
          this.appendChild(errorMessage);
          
          // Remove error message after 5 seconds
          setTimeout(() => {
            if (errorMessage.parentNode) {
              errorMessage.parentNode.removeChild(errorMessage);
            }
          }, 5000);
        } finally {
          // Re-enable submit button after 3 seconds
          setTimeout(() => {
            submitButton.disabled = false;
            submitButton.innerHTML = originalHTML;
            submitButton.classList.remove('bg-green-500', 'hover:bg-green-600');
          }, 3000);
        }
      });
    }
  });
</script>
