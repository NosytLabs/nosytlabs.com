---
/**
 * NavigationLink Component
 *
 * A reusable navigation link component that handles active state styling,
 * supports icons, and works for both mobile and desktop navigation.
 */

import AstroIcon from '../ui/AstroIcon.astro';
import NavigationBadge from './NavigationBadge.astro';
import type { NavigationItem } from '../../config/navigation-constants';

export interface Props extends NavigationItem {
  currentPath: string;
  isMobile?: boolean;
  className?: string;
  animated?: boolean;
  external?: boolean;
}

const {
  name,
  href,
  icon,
  description,
  isNew,
  aiPowered,
  currentPath,
  isMobile = false,
  className = '',
  animated = true,
  external = false,
} = Astro.props;

// Determine if the current link is active
const isActive = currentPath === href || (href !== '/' && currentPath && currentPath.startsWith(href));

// Note: All styling is handled directly in the class:list for better conditional logic

// Note: Classes are applied using class:list for better conditional handling
---

<a
  {href}
  class:list={[
    'relative flex items-center transition-colors duration-300 ease-out transform-gpu will-change-transform',
    animated && 'hover:scale-105 hover:shadow-md active:scale-95',
    isMobile
      ? [
'block py-3 px-4 text-lg font-medium w-full focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-600 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-background',
          isActive
            ? 'text-text dark:text-text font-semibold'
            : 'text-text dark:text-text hover:text-primary-800 hover:dark:text-primary-300'
        ]
      : [
'inline-flex items-center px-3 py-2 text-sm font-medium rounded-md focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-600 dark:focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-background',
          isActive
            ? 'text-text dark:text-text bg-gradient-to-r from-primary/10 to-primary/5 backdrop-blur-sm px-3 py-2 rounded-md font-semibold shadow-sm border-l-4 border-primary'
            : 'text-text dark:text-text hover:text-primary-800 hover:dark:text-primary-300',
          'after:absolute after:bottom-0 after:left-0 after:w-full after:h-[2px] after:bg-current',
          'after:transform after:transition-transform after:duration-300 after:ease-in-out',
          isActive ? 'after:scale-x-100' : 'after:scale-x-0 hover:after:scale-x-100'
        ],
    className,
  ]}
  aria-current={isActive ? 'page' : undefined}
  title={description}
  {...(external && { target: '_blank', rel: 'noopener noreferrer' })}
>
  <span class="flex items-center space-x-2">
    {
      icon && (
        <span class:list={[
          'inline-flex items-center transition-all duration-300',
          animated && 'group-hover:scale-110 group-hover:rotate-3',
          isActive && 'animate-pulse'
        ]}>
          <AstroIcon name={icon} size={isMobile ? 24 : 18} />
        </span>
      )
    }
    <span class:list={[
      'transition-all duration-300',
      animated && isActive && 'animate-slideInLeft'
    ]}>{name}</span>
  </span>

  {
    (isNew || aiPowered) && (
      <span class="flex items-center space-x-2 ml-2">
        {isNew && <NavigationBadge type="new" pulse={true} />}
        {aiPowered && <NavigationBadge type="ai" pulse={true} />}
      </span>
    )
  }

  {
    external && (
      <AstroIcon
        name="tabler:external-link"
        class="w-4 h-4 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity duration-200"
      />
    )
  }

  {
    isActive && (
      <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-primary rounded-r-full animate-slideInLeft" />
    )
  }

  <div class:list={[
    'absolute inset-0 rounded-lg opacity-0 transition-opacity duration-300',
    'bg-gradient-to-r from-primary/5 to-transparent',
    animated && 'group-hover:opacity-100',
  ]} />
</a>
