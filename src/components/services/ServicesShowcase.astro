---
/**
 * Services Showcase Component
 * 
 * Comprehensive display of all services with filtering, search, and conversion optimization
 */

import { allServices, getServicesByCategory } from '../../config/services';
import EnhancedServiceCard from './EnhancedServiceCard.astro';
import AstroIcon from '../ui/AstroIcon.astro';
import Button from '../ui/Button.astro';

interface Props {
  showFilters?: boolean;
  featuredOnly?: boolean;
  limit?: number;
  category?: string;
}

const { 
  showFilters = true, 
  featuredOnly = false, 
  limit,
  category 
} = Astro.props;

let services = category ? getServicesByCategory(category) : allServices;

if (featuredOnly) {
  services = services.filter(service => service.popular);
}

if (limit) {
  services = services.slice(0, limit);
}

const categories = [...new Set(allServices.map(service => service.category))];
const popularServices = services.filter(service => service.popular);
const regularServices = services.filter(service => !service.popular);
---

<section class="py-20 bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800">
    <div class="container mx-auto px-4">
      <!-- Section Header -->
      <div class="text-center mb-16 entrance-fade">
        <div class="inline-flex items-center px-4 py-2 rounded-full bg-primary/10 text-primary font-medium text-sm mb-4 entrance-slide-up">
          <AstroIcon name="zap" class="w-4 h-4 mr-2" />
          Our Services
        </div>
        <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6 entrance-slide-up">
          Transform Your Business with
          <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
            Expert Solutions
          </span>
        </h2>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto leading-relaxed entrance-slide-up">
          From cutting-edge web development to AI-powered automation, we deliver comprehensive 
          technology solutions that drive growth and innovation for your business.
        </p>
      </div>

    <!-- Category Filters -->
    {showFilters && (
      <div class="flex flex-wrap justify-center gap-4 mb-12 entrance-fade" data-category-filters>
        <button 
          class="category-filter active px-6 py-3 rounded-full font-medium transition-all duration-300 bg-primary text-white shadow-lg hover:shadow-xl"
          data-category="all"
        >
          All Services
        </button>
        {categories.map((cat) => (
          <button 
            class="category-filter px-6 py-3 rounded-full font-medium transition-all duration-300 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-700 hover:border-primary hover:text-primary hover:shadow-lg"
            data-category={cat.toLowerCase().replace(/\s+/g, '-')}
          >
            {cat}
          </button>
        ))}
      </div>
    )}

    <!-- Services Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 mb-16 entrance-fade">
      <!-- Popular Services First -->
      {popularServices.map((service) => (
        <EnhancedServiceCard 
          service={service} 
          featured={true}
          data-category={service.category.toLowerCase().replace(/\s+/g, '-')}
        />
      ))}
      
      <!-- Regular Services -->
      {regularServices.map((service) => (
        <EnhancedServiceCard 
          service={service}
          data-category={service.category.toLowerCase().replace(/\s+/g, '-')}
        />
      ))}
    </div>

    <!-- Stats Section -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-16 p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg entrance-fade">
      <div class="text-center entrance-slide-up">
        <div class="text-3xl font-bold text-primary mb-2" data-counter="150">0</div>
        <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Projects Completed</div>
      </div>
      <div class="text-center entrance-slide-up">
        <div class="text-3xl font-bold text-primary mb-2" data-counter="98">0</div>
        <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Client Satisfaction</div>
      </div>
      <div class="text-center entrance-slide-up">
        <div class="text-3xl font-bold text-primary mb-2" data-counter="24">0</div>
        <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Hour Support</div>
      </div>
      <div class="text-center entrance-slide-up">
        <div class="text-3xl font-bold text-primary mb-2" data-counter="5">0</div>
        <div class="text-sm text-gray-600 dark:text-gray-400 uppercase tracking-wide">Years Experience</div>
      </div>
    </div>

    <!-- Process Section -->
    <div class="mb-16 entrance-fade">
      <h3 class="text-3xl font-bold text-center text-gray-900 dark:text-white mb-12 entrance-slide-up">
        Our Proven Process
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 entrance-fade">
        <div class="text-center group entrance-slide-up">
          <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-xl group-hover:scale-110 transition-transform duration-300">
            1
          </div>
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Discovery</h4>
          <p class="text-gray-600 dark:text-gray-300 text-sm">We analyze your needs and goals to create a tailored strategy</p>
        </div>
        <div class="text-center group entrance-slide-up">
          <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-xl group-hover:scale-110 transition-transform duration-300">
            2
          </div>
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Design</h4>
          <p class="text-gray-600 dark:text-gray-300 text-sm">We create detailed plans and prototypes for your approval</p>
        </div>
        <div class="text-center group entrance-slide-up">
          <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-xl group-hover:scale-110 transition-transform duration-300">
            3
          </div>
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Develop</h4>
          <p class="text-gray-600 dark:text-gray-300 text-sm">We build your solution using cutting-edge technologies</p>
        </div>
        <div class="text-center group entrance-slide-up">
          <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-xl group-hover:scale-110 transition-transform duration-300">
            4
          </div>
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Deploy</h4>
          <p class="text-gray-600 dark:text-gray-300 text-sm">We launch your solution and provide ongoing support</p>
        </div>
      </div>
    </div>

    <!-- CTA Section -->
    <div class="text-center bg-gradient-to-r from-primary to-secondary rounded-2xl p-12 text-white entrance-fade">
      <h3 class="text-3xl font-bold mb-4">
        Ready to Transform Your Business?
      </h3>
      <p class="text-xl mb-8 opacity-90">
        Let's discuss how our services can help you achieve your goals
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button
          href="/contact"
          variant="secondary"
          size="lg"
          class="bg-white text-primary hover:bg-gray-100"
        >
          Start Your Project
          <AstroIcon name="arrowRight" class="w-5 h-5 ml-2" />
        </Button>
        <Button
          href="/projects"
          variant="outline"
          size="lg"
          class="border-white text-white hover:bg-white hover:text-primary"
        >
          View Our Work
        </Button>
      </div>
    </div>
  </div>
</section>

<script>
  // Category filtering functionality
  document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.category-filter');
    const serviceCards = document.querySelectorAll('[data-service-card]');
    const counters = document.querySelectorAll('[data-counter]');

    // Category filtering
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const category = this.getAttribute('data-category');
        
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active', 'bg-primary', 'text-white', 'shadow-lg'));
        filterButtons.forEach(btn => btn.classList.add('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-700'));
        
        this.classList.add('active', 'bg-primary', 'text-white', 'shadow-lg');
        this.classList.remove('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300', 'border', 'border-gray-200', 'dark:border-gray-700');
        
        // Filter cards
        serviceCards.forEach(card => {
          const cardCategory = card.getAttribute('data-category');
          if (category === 'all' || cardCategory === category) {
            card.style.display = 'block';
            card.classList.remove('entrance-fade', 'entrance-slide-up');
            // Use centralized entrance animation utility
            requestAnimationFrame(() => {
              card.classList.add('entrance-slide-up');
            });
          } else {
            card.style.display = 'none';
          }
        });
      });
    });

    // Counter animation
    const animateCounter = (element) => {
      const target = parseInt(element.getAttribute('data-counter'));
      const duration = 2000;
      const step = target / (duration / 16);
      let current = 0;
      
      const timer = setInterval(() => {
        current += step;
        if (current >= target) {
          element.textContent = target + (target === 98 ? '%' : target === 24 ? '/7' : '');
          clearInterval(timer);
        } else {
          element.textContent = Math.floor(current) + (target === 98 ? '%' : target === 24 ? '/7' : '');
        }
      }, 16);
    };

    // Intersection Observer for counter animation
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounter(entry.target);
          observer.unobserve(entry.target);
        }
      });
    });

    counters.forEach(counter => observer.observe(counter));
  });
</script>

<style>
  .category-filter.active {
    transform: translateY(-2px);
  }
  
  .category-filter:hover {
    transform: translateY(-1px);
  }
  
</style>