---
import { SITE_CONFIG, COMPANY_INFO, createInternalLink } from '../../lib/constants'; 
import Button from "@/components/ui/Button.astro";
import Icon from "@/lib/icons/Icon";
import { icons } from "@/lib/icons/icons";
import newsletterSubscribeClientUrl from "../../lib/forms/newsletter-subscribe-client.ts?url";

const {
  showNewsletter = true,
  companyName = COMPANY_INFO.NAME,
  tagline = COMPANY_INFO.TAGLINE,
  description = COMPANY_INFO.DESCRIPTION,
  contactEmail = SITE_CONFIG.EMAILS.CONTACT,
  location = COMPANY_INFO.LOCATION,
} = Astro.props;

const links = {
  services: [
    { href: createInternalLink("/services/professional-web-development"), text: "Web Development", iconKey: "web-development" },
    { href: createInternalLink("/services/ai-integration-automation"), text: "AI Integration", iconKey: "ai-integration" },
    { href: createInternalLink("/services/rapid-prototype-development"), text: "Rapid Prototyping", iconKey: "consulting" },
    { href: createInternalLink("/services/mobile-app-development"), text: "Mobile Apps", iconKey: "brain" },
    { href: createInternalLink("/services/tech-consulting-seo-audits"), text: "Tech Consulting", iconKey: "brain" },
    { href: createInternalLink("/services/3d-printing-services"), text: "3D Printing", iconKey: "brain" },
  ],
  company: [
    { href: createInternalLink("/about"), text: "About", iconKey: "brain" },
    { href: createInternalLink("/blog"), text: "Blog", iconKey: "brain" },
    { href: createInternalLink("/contact"), text: "Contact", iconKey: "brain" },
  ],
  legal: [
    { href: createInternalLink("/privacy"), text: "Privacy Policy", iconKey: "brain" },
    { href: createInternalLink("/terms"), text: "Terms of Service", iconKey: "brain" },
    { href: createInternalLink("/cookies"), text: "Cookie Policy", iconKey: "brain" },
    { href: createInternalLink("/disclaimer"), text: "Disclaimer", iconKey: "brain" },
  ],
};

const social = [
  {
    href: "https://twitter.com/nosytlabs",
    iconKey: "twitter",
    label: "Twitter",
    color: "hover:text-primary",
  },
  {
    href: "https://linkedin.com/company/nosytlabs",
    iconKey: "linkedin",
    label: "LinkedIn",
    color: "hover:text-primary",
  },
  {
    href: "https://github.com/nosytlabs",
    iconKey: "github",
    label: "GitHub",
    color: "hover:text-foreground",
  },
  {
    href: `mailto:${contactEmail}`,
    iconKey: "brain",
    label: "Email",
    color: "hover:text-success",
  },
];

const currentYear = new Date().getFullYear();

// Helper function to get icon paths
function getIconPaths(iconKey: string) {
  // Handle special cases for icons defined in icon-factory
  const specialIcons: Record<string, string[]> = {
    github: ["M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4", "M9 18c-4.51 2-5-2-7-2"],
    linkedin: ["M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z", "M2 9h4v12H2z", "M4 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"],
    twitter: ["M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"]
  };
  
  return specialIcons[iconKey] || icons[iconKey as keyof typeof icons] || icons['brain'] || [];
}
---

<footer class="bg-background border-t border-border text-foreground">
  <div class="container-xl py-16 md:py-20 lg:py-24">
    <!-- Brand Section - Enhanced -->
    <div class="text-center mb-16 md:mb-20">
      <div class="flex items-center justify-center mb-6">
        <div class="w-16 h-16 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center shadow-lg">
          <Icon paths={getIconPaths("brain")} size={32} className="text-white" />
        </div>
      </div>
      
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4">
        {companyName}
      </h2>
      <p class="text-base md:text-lg text-muted-foreground max-w-2xl mx-auto mb-3 leading-relaxed">
        {description}
      </p>
      <p class="text-sm text-muted-foreground/80">{tagline}</p>
    </div>

    <!-- Main Footer Grid - Enhanced -->
    <div class="footer-grid mb-16 md:mb-20">
      <!-- Services Section - Enhanced -->
      <div class="space-y-4">
        <h3 class="text-lg md:text-xl font-bold mb-4 md:mb-6 text-foreground">
          Services
        </h3>
        <ul class="space-y-2">
          {links.services.map((link) => (
            <li>
              <a
                href={link.href}
                class="flex items-center space-x-2 text-sm md:text-base text-muted-foreground hover:text-primary py-2 px-3 rounded-lg hover:bg-muted/30 transition-all duration-200 group"
                aria-label={`${link.text} service`}
              >
                <svg class="w-4 h-4 text-primary/50 group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="font-medium">{link.text}</span>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Company Section - Enhanced -->
      <div class="space-y-4">
        <h3 class="text-lg md:text-xl font-bold mb-4 md:mb-6 text-foreground">
          Company
        </h3>
        <ul class="space-y-2">
          {links.company.map((link) => (
            <li>
              <a
                href={link.href}
                class="flex items-center space-x-2 text-sm md:text-base text-muted-foreground hover:text-primary py-2 px-3 rounded-lg hover:bg-muted/30 transition-all duration-200 group"
                aria-label={link.text}
              >
                <svg class="w-4 h-4 text-primary/50 group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="font-medium">{link.text}</span>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Contact Section - Enhanced -->
      <div class="space-y-4">
        <h3 class="text-lg md:text-xl font-bold mb-4 md:mb-6 text-foreground">
          Get in Touch
        </h3>
        <div class="space-y-3">
          <a
            href={`mailto:${contactEmail}`}
            class="flex items-center space-x-3 text-sm md:text-base text-muted-foreground hover:text-primary p-3 rounded-lg hover:bg-muted/30 transition-all duration-200 group"
            aria-label={`Email us at ${contactEmail}`}
          >
            <svg class="w-5 h-5 text-primary/50 group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <span class="font-medium">{contactEmail}</span>
          </a>
          
          <div class="p-4 rounded-lg bg-gradient-to-br from-muted/50 to-muted/30 border border-border/50">
            <div class="flex items-center space-x-2 mb-2">
              <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <p class="text-xs font-semibold text-foreground/80 uppercase tracking-wide">Location</p>
            </div>
            <p class="text-sm font-medium text-foreground">{location}</p>
          </div>
        </div>
      </div>

      <!-- Legal Section - Enhanced -->
      <div class="space-y-4">
        <h3 class="text-lg md:text-xl font-bold mb-4 md:mb-6 text-foreground">
          Legal
        </h3>
        <ul class="space-y-2">
          {links.legal.map((link) => (
            <li>
              <a
                href={link.href}
                class="flex items-center space-x-2 text-sm md:text-base text-muted-foreground hover:text-primary py-2 px-3 rounded-lg hover:bg-muted/30 transition-all duration-200 group"
                aria-label={link.text}
              >
                <svg class="w-4 h-4 text-primary/50 group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="font-medium">{link.text}</span>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Newsletter Section - Simplified -->
      {showNewsletter && (
        <div class="space-y-4">
          <h3 class="text-xl font-bold mb-4">
            Stay Connected
          </h3>
          <div class="space-y-4">
            <p class="text-muted-foreground text-sm">
              Get the latest updates on web development, AI innovations, and tech insights.
            </p>
            <form
              class="space-y-3"
              aria-label="Newsletter subscription"
              data-newsletter-form
              id="newsletter-form"
              novalidate
            >
              <div>
                <label for="newsletter-email" class="sr-only">Email address for newsletter subscription</label>
                <input
                  type="email"
                  name="email"
                  id="newsletter-email"
                  placeholder="Enter your email"
                  required
                  aria-label="Email address"
                  aria-describedby="newsletter-description newsletter-status"
                  class="flex min-h-[44px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50"
                />
              </div>
              <div id="newsletter-description" class="sr-only">
                Subscribe to receive updates on web development, AI, and tech innovations
              </div>
              <div id="newsletter-status" class="form-helper-text" aria-live="polite">
                Newsletter form ready
              </div>
              <Button
                type="submit"
                text="Subscribe"
                variant="primary"
                class="w-full"
                aria-describedby="newsletter-status"
              />
            </form>
          </div>
        </div>
      )}
    </div>

    <!-- Social Media & Legal - Simplified -->
    <div class="border-t border-border pt-8">
      <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
        <!-- Social Media Icons -->
        <div class="flex flex-col sm:flex-row items-center gap-4">
          <span class="text-muted-foreground text-sm font-medium">Follow Us:</span>
          <div class="flex space-x-3">
            {social.map((item) => (
              <a
                href={item.href}
                class="w-10 h-10 bg-muted rounded-lg flex items-center justify-center hover:bg-primary/20 transition-colors"
                aria-label={`Follow us on ${item.label}`}
                {...(item.href.startsWith("http") && {
                  target: "_blank",
                  rel: "noopener noreferrer",
                })}
              >
                <Icon paths={getIconPaths(item.iconKey)} size={18} />
              </a>
            ))}
          </div>
        </div>

        <!-- Copyright -->
        <div class="text-center lg:text-right">
          <p class="text-muted-foreground text-sm">
            © {currentYear} {companyName}. All rights reserved.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

<script type="module" is:inline src={newsletterSubscribeClientUrl}></script>
