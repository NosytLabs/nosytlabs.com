---
/**
 * Optimized Non-Blocking Font Preloader Component
 * Implements performance-first font loading strategy with self-hosted Inter font
 * Eliminates external dependencies and reduces FOUT/FOIT without blocking render
 */
---

<!-- Non-blocking font preload - loads after critical resources -->
<link rel="preload" href="/fonts/inter-latin.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<style is:inline>
/* ==========================================================================
   CRITICAL FONT LOADING - INLINED FOR IMMEDIATE RENDERING
   ========================================================================== */

/* Self-hosted Inter font - Latin subset only for optimal performance */
@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-weight: 100 900; /* Variable font supports full weight range */
  font-display: swap; /* Non-blocking font display */
  src: url('/fonts/inter-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

/* Optimized font loading with system fallbacks */
:root {
  /* Primary font stack with system fallbacks */
  --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  
  /* Monospace stack for code */
  --font-family-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Consolas', 'Courier New', monospace;
  
  /* Font display optimization */
  --font-display: swap;
}

/* Immediate font application - no waiting for font load */
body {
  font-family: var(--font-family-primary);
  /* Match Inter's metrics to reduce layout shift */
  font-size-adjust: 0.5;
}

/* Global font optimization */
* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* Font display optimization for all text elements */
h1, h2, h3, h4, h5, h6,
.hero-title,
.hero-description,
.nav-link,
.btn,
.card-title,
.testimonial-text {
  font-display: var(--font-display);
  font-family: var(--font-family-primary);
}

/* Code elements use monospace stack */
code, pre, .font-mono {
  font-family: var(--font-family-mono);
  font-display: var(--font-display);
}

/* Font weight utilities using variable font */
.font-normal { font-weight: 400; }
.font-medium { font-weight: 500; }
.font-semibold { font-weight: 600; }
.font-bold { font-weight: 700; }
</style>

<script>
/**
 * Non-blocking font loading optimization
 * Uses Font Loading API for better performance control
 */
(function() {
  'use strict';
  
  // Check if Font Loading API is supported
  if ('fonts' in document) {
    // Load Inter font asynchronously
    const interFont = new FontFace('Inter', 'url(/fonts/inter-latin.woff2) format("woff2")', {
      weight: '100 900',
      style: 'normal',
      display: 'swap'
    });
    
    // Add font to document fonts
    document.fonts.add(interFont);
    
    // Load font without blocking
    interFont.load().then(function() {
      // Font loaded successfully
      document.body.classList.add('fonts-loaded');
      
      // Optional: Log font loading success for debugging
      if (window.performance && window.performance.mark) {
        performance.mark('font-inter-loaded');
      }
    }).catch(function(error) {
      // Font loading failed - fallback fonts will be used
      console.warn('Inter font failed to load:', error);
      document.body.classList.add('fonts-fallback');
    });
    
    // Set a timeout to ensure we don't wait too long
    setTimeout(function() {
      if (!document.body.classList.contains('fonts-loaded')) {
        document.body.classList.add('fonts-timeout');
      }
    }, 3000); // 3 second timeout
    
  } else {
    // Fallback for browsers without Font Loading API
    document.body.classList.add('fonts-fallback');
  }
  
  // Preload critical fonts for next navigation
  if ('requestIdleCallback' in window) {
    requestIdleCallback(function() {
      // Preload additional font weights if needed
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = '/fonts/inter-latin.woff2';
      link.as = 'font';
      link.type = 'font/woff2';
      link.crossOrigin = 'anonymous';
      document.head.appendChild(link);
    });
  }
})();
</script>