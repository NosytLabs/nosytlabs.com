---
import OptimizedImage from '@/components/ui/OptimizedImage.astro';
import { createInternalLink } from '@/lib/constants';
import type { BlogPost } from "../../types/blog";

interface Props {
  post: BlogPost;
}

const { post } = Astro.props as Props;

// Add safety checks for post and post.data
if (!post || !post.data) {
  throw new Error('BlogPostCard: post or post.data is undefined');
}

const { title, description, pubDate, tags = [], heroImage } = post.data;
const { slug } = post;

const formattedDate = pubDate ? pubDate.toLocaleDateString('en-US', { 
  year: 'numeric', 
  month: 'short', 
  day: 'numeric' 
}) : 'No date';
---

<article 
  class="group relative overflow-hidden h-full flex flex-col rounded-2xl border-2 border-default-200 bg-content1 hover:border-primary hover:shadow-xl transition-all duration-300 hover:-translate-y-1" 
  role="article" 
  aria-label={`Blog post: ${title}`}
  tabIndex="0"
  data-blog-card
>
  <!-- Simplified gradient overlay -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-primary/10 opacity-0 group-hover:opacity-100 transition-all duration-500 pointer-events-none"></div>
  
  <a href={createInternalLink(`/blog/${slug}`)} class="block focus:outline-none relative z-content" aria-label={`Read more about ${title}`}>
    <div class="h-44 sm:h-52 md:h-56 rounded-t-2xl overflow-hidden mb-5 relative group/image">
      {heroImage ? (
        <OptimizedImage
          src={heroImage}
          alt={title}
          width={400}
          height={300}
          loading="lazy"
          quality={80}
          format="webp"
          sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
          class="w-full h-full object-cover transition-colors duration-700"
        />
      ) : (
        <div class="w-full h-full bg-gradient-to-br from-primary/20 via-accent/30 to-primary/20 flex items-center justify-center relative overflow-hidden">
          <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-lg bg-card/30 backdrop-blur-md flex items-center justify-center border border-white/20 group-hover:border-primary/50 transition-colors duration-300">
            <svg class="w-8 h-8 sm:w-10 sm:h-10 text-primary group-hover:text-accent transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 002-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
            </svg>
          </div>
        </div>
      )}
      
      <!-- Simplified reading time overlay -->
      <div class="absolute top-4 right-4 px-3 py-1 bg-background/90 backdrop-blur-md rounded-full text-xs font-medium text-foreground border border-border/50 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center gap-1.5">
        <svg class="w-3 h-3 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        5 min read
      </div>
      
      <!-- Image overlay gradient -->
      <div class="absolute inset-0 bg-gradient-to-t from-background/60 via-background/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-content"></div>
    </div>
  </a>
  
  <div class="px-6 pb-6 flex flex-col flex-grow relative z-content">
    <!-- Simplified tags -->
    <div class="flex flex-wrap gap-2 mb-4">
      {tags.slice(0, 3).map((tag: string, _index: number) => (
        <span 
          class="px-3 py-1 text-xs font-semibold bg-primary/10 text-primary rounded-full border border-primary/20 hover:bg-primary/20 transition-colors duration-300"
        >
          #{tag}
        </span>
      ))}
      {tags.length > 3 && (
        <span class="px-3 py-1 text-xs font-semibold bg-muted/50 text-muted-foreground rounded-full border border-border/30">
          +{tags.length - 3} more
        </span>
      )}
    </div>
    
    <!-- Simplified title -->
    <h3 class="text-xl font-bold text-foreground mb-3 group-hover:text-primary transition-colors duration-500 leading-snug">
      <a href={createInternalLink(`/blog/${slug}`)} class="focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded">
        {title}
      </a>
    </h3>
    
    <!-- Simplified description -->
    <p class="text-sm text-muted-foreground mb-5 line-clamp-3 leading-relaxed flex-grow">
      {description}
    </p>
    
    <!-- Simplified footer -->
    <footer class="flex items-center justify-between pt-4 border-t border-border/30 group-hover:border-primary/20 transition-colors duration-300">
      <time 
        datetime={pubDate ? pubDate.toISOString() : new Date().toISOString()} 
        class="text-xs font-medium text-muted-foreground group-hover:text-primary transition-colors duration-300 flex items-center gap-1.5"
      >
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        {formattedDate}
      </time>
      
      <!-- Simplified read more indicator -->
      <div class="flex items-center gap-1.5 text-xs font-medium text-primary group-hover:text-accent transition-colors duration-300">
        <span>Read more</span>
        <svg class="w-3 h-3 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </footer>
  </div>
</article>

