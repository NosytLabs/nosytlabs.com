---
// BaseLayout.astro - Modern layout for the website
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SearchModal from '../components/SearchModal.astro';
import VercelAnalytics from '../components/VercelAnalytics.astro';

export interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  isNosytOS95?: boolean;
}

const {
  title = 'NosytLabs - Notable Opportunities Shape Your Tomorrow',
  description = 'NosytLabs - Innovative digital solutions that help businesses thrive in the modern landscape.',
  ogImage = '/images/nosytlabs-og.jpg',
  isNosytOS95 = false
} = Astro.props;

// Generate a unique ID for this page
const pageId = `page-${Math.random().toString(36).substring(2, 9)}`;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>

  <!-- Favicons - Updated with NosytLabs logo 2025 -->
  <link rel="icon" type="image/svg+xml" href="/images/nosytlabs-logo-2025.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <!-- Standard Favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <!-- Web Manifest -->
  <link rel="manifest" href="/site.webmanifest">
  <!-- Theme Colors -->
  <meta name="theme-color" content="#4C1D95">
  <meta name="msapplication-TileColor" content="#4C1D95">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={Astro.url}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={ogImage}>
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content={title}>
  <meta property="twitter:description" content={description}>
  <meta property="twitter:image" content={ogImage}>

  <!-- Canonical URL -->
  <link rel="canonical" href={new URL(Astro.url.pathname, Astro.site || 'https://nosytlabs.com').href}>

  <!-- Keywords -->
  <meta name="keywords" content="AI solutions, web development, mobile apps, 3D printing, technology">

  <!-- Structured Data for Organization -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "NosytLabs",
      "url": "https://nosytlabs.com",
      "logo": "https://nosytlabs.com/images/nosytlabs-logo-2025.svg",
      "description": "Notable Opportunities Shape Your Tomorrow - Innovative digital solutions that help businesses thrive in the modern landscape.",
      "sameAs": [
        "https://github.com/NosytLabs",
        "https://kick.com/Tycen",
        "https://www.youtube.com/@TycenYT",
        "https://crealitycloud.com/user/9519489699"
      ]
    }
  </script>

  <!-- Resource hints for critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <!-- Preload critical resources -->
  <link rel="preload" href="/images/nosytlabs-logo-2025.svg" as="image" fetchpriority="high">
  <link rel="preload" href="/styles/global.css" as="style">
  <link rel="preload" href="/scripts/main.js" as="script">

  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">

  <!-- Fonts with optimized loading -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet"
        media="print"
        onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  </noscript>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Global styles -->
  <link rel="stylesheet" href="/styles/global.css">

  <!-- NosytOS95 specific styles - only loaded on the NosytOS95 page -->
  {isNosytOS95 && (
    <>
      <link rel="stylesheet" href="/styles/win95-authentic.css">
      <link rel="stylesheet" href="/styles/ms-sans-serif.css">
      <link rel="stylesheet" href="/styles/nosyt-window-manager.css">
      <link rel="stylesheet" href="/styles/nosyt-bsod.css">
      <link rel="stylesheet" href="/styles/nosyt-ai.css">
      <link rel="stylesheet" href="/styles/nosyt-file-explorer.css">
    </>
  )}

  <!-- Core functionality - high priority -->
  <script is:inline src="/scripts/main.js" defer fetchpriority="high"></script>

  <!-- NosytOS95 specific scripts are now loaded directly in the nosytos95.astro page -->
  {isNosytOS95 && (
    <script is:inline>
      // NosytOS95 scripts are loaded inline to avoid import errors
      console.log('NosytOS95 scripts loaded');
    </script>
  )}

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('ServiceWorker registered successfully');
          })
          .catch(error => {
            console.error('ServiceWorker registration failed:', error);
          });
      });
    }
  </script>
</head>
<body id={pageId} class="overflow-x-hidden overflow-y-auto">
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Header - Only show modern header on non-NosytOS95 pages -->
  {!isNosytOS95 && <Header />}

  <!-- Main Content -->
  <main id="main-content" class="min-h-screen relative">
    {!isNosytOS95 && (
      <div id="particle-background" class="particle-background absolute inset-0 pointer-events-none z-0"
        data-color="rgba(76, 29, 149, 0.2)"
        data-secondary-color="rgba(255, 107, 0, 0.2)"
        data-particle-count="100"
        data-particle-size="3"
        data-particle-speed="1"
        data-interactive="true"
        data-connect-particles="true"
        data-gradient="true">
      </div>
    )}

    <!-- Main Content -->
    <div class="relative z-10">
      <slot />
    </div>
  </main>

  <!-- Footer - Only show modern footer on non-NosytOS95 pages -->
  {!isNosytOS95 && <Footer />}

  <!-- Search Modal - Available on all pages -->
  {!isNosytOS95 && <SearchModal />}

  <!-- Back to top button -->
  {!isNosytOS95 && (
    <button
      id="back-to-top"
      class="fixed bottom-6 right-6 bg-primary hover:bg-primary-dark text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 opacity-0 invisible z-50"
      aria-label="Back to top"
    >
      <i class="fas fa-arrow-up"></i>
    </button>
  )}

  <!-- Theme toggle script -->
  <script is:inline>
    // Check for saved theme preference or use system preference
    const getThemePreference = () => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    // Apply theme
    const theme = getThemePreference();
    document.documentElement.classList.toggle('dark', theme === 'dark');

    // Store theme preference
    if (typeof localStorage !== 'undefined') {
      localStorage.setItem('theme', theme);
    }
  </script>

  <!-- Back to top button script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const backToTopButton = document.getElementById('back-to-top');

      if (backToTopButton) {
        // Show/hide button based on scroll position
        window.addEventListener('scroll', () => {
          if (window.scrollY > 300) {
            backToTopButton.classList.remove('opacity-0', 'invisible');
            backToTopButton.classList.add('opacity-100', 'visible');
          } else {
            backToTopButton.classList.remove('opacity-100', 'visible');
            backToTopButton.classList.add('opacity-0', 'invisible');
          }
        });

        // Scroll to top when clicked
        backToTopButton.addEventListener('click', () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }
    });
  </script>

  <!-- Vercel Analytics -->
  <VercelAnalytics />
</body>
</html>
